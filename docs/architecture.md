# KTX ìë™ ì¡°íšŒ/ì˜ˆì•½ í…ŒìŠ¤íŠ¸ ì•± - ì•„í‚¤í…ì²˜ ì„¤ê³„ ë¬¸ì„œ

---

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œìš”

### 1.1 ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Flutter App (Client)   â”‚
â”‚    MVVM + Riverpod           â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Presentation Layer    â”‚  â”‚
â”‚  â”‚  (Screens, Widgets,    â”‚  â”‚
â”‚  â”‚   Providers)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Data Layer            â”‚  â”‚
â”‚  â”‚  (Models, Repository,  â”‚  â”‚
â”‚  â”‚   ApiClient)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚ HTTP (dio)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  REST API (JSON)
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Python Backend (Server)   â”‚
â”‚    FastAPI + Uvicorn         â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Layer             â”‚  â”‚
â”‚  â”‚  (Routes, Deps)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Service Layer         â”‚  â”‚
â”‚  â”‚  (KorailService,       â”‚  â”‚
â”‚  â”‚   RetryService)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  korail2 (ë¹„ê³µì‹ API)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  HTTP (ë¹„ê³µì‹)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ì½”ë ˆì¼ ì„œë²„ (ì™¸ë¶€)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|------|
| **Frontend** | Flutter | 3.x (SDK ^3.9.2) | í¬ë¡œìŠ¤í”Œë«í¼ ëª¨ë°”ì¼ UI |
| **ìƒíƒœê´€ë¦¬** | flutter_riverpod | ^2.4.0 | MVVM íŒ¨í„´ ìƒíƒœ ê´€ë¦¬ |
| **HTTP Client** | dio | ^5.4.0 | REST API í†µì‹  |
| **ë¼ìš°íŒ…** | go_router | ^14.0.0 | ì„ ì–¸ì  ë„¤ë¹„ê²Œì´ì…˜ |
| **ë‚ ì§œ í¬ë§·** | intl | ^0.19.0 | ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ… |
| **ì½”ë“œ ìƒì„±** | freezed + build_runner | ^2.4.0 | ë¶ˆë³€ ëª¨ë¸ í´ë˜ìŠ¤ ìƒì„± |
| **Backend** | FastAPI | >=0.109.0 | Python REST API ì„œë²„ |
| **ASGI Server** | uvicorn | >=0.27.0 | FastAPI ì‹¤í–‰ ì„œë²„ |
| **ì½”ë ˆì¼ API** | korail2 | >=0.1.0 | ì½”ë ˆì¼ ë¹„ê³µì‹ API ë˜í¼ |
| **í™˜ê²½ë³€ìˆ˜** | python-dotenv | >=1.0.0 | .env íŒŒì¼ ê´€ë¦¬ |
| **ë°ì´í„° ê²€ì¦** | pydantic | >=2.5.0 | ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ê²€ì¦ |

### 1.3 í†µì‹  íë¦„

```
Flutter App                    FastAPI Backend              ì½”ë ˆì¼ ì„œë²„
    â”‚                              â”‚                           â”‚
    â”‚  POST /api/auth/login        â”‚                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  korail2.Korail(id, pw)   â”‚
    â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  session_token            â”‚
    â”‚                              â”‚                           â”‚
    â”‚  GET /api/trains/search      â”‚                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  korail2.search_train()   â”‚
    â”‚  (5~10ì´ˆ ì£¼ê¸° ë°˜ë³µ)           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  train_list               â”‚
    â”‚                              â”‚                           â”‚
    â”‚  POST /api/reservation       â”‚                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  korail2.reserve(train)   â”‚
    â”‚  (ì¢Œì„ ë°œê²¬ ì‹œ ìë™)          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  reservation_result       â”‚
    â”‚                              â”‚                           â”‚
```

---

## 2. Flutter í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜

### 2.1 MVVM + Riverpod íŒ¨í„´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Screens  â”‚â—„â”€â”€â–ºâ”‚  Providers   â”‚    â”‚     Widgets      â”‚  â”‚
â”‚  â”‚ (View)   â”‚    â”‚ (ViewModel)  â”‚    â”‚  (ì¬ì‚¬ìš© UI)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Data Layer                                â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              TrainRepository                          â”‚  â”‚
â”‚  â”‚   (API í˜¸ì¶œ ì¶”ìƒí™”, ì—ëŸ¬ ë³€í™˜, ë°ì´í„° ìºì‹±)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               ApiClient (dio)                         â”‚  â”‚
â”‚  â”‚   (HTTP í†µì‹ , ì¸í„°ì…‰í„°, íƒ€ì„ì•„ì›ƒ, í—¤ë” ê´€ë¦¬)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               Models                                  â”‚  â”‚
â”‚  â”‚   (Train, Reservation, SearchCondition, LogEntry)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Core Layer                                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Constants  â”‚  â”‚   Theme    â”‚  â”‚      Utils         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 í´ë” êµ¬ì¡°

```
lib/
â”œâ”€â”€ main.dart                          # ì•± ì§„ì…ì , ProviderScope ë˜í•‘
â”œâ”€â”€ app.dart                           # MaterialApp + GoRouter ì„¤ì •
â”‚
â”œâ”€â”€ core/                              # ì•± ì „ì—­ ê³µí†µ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ stations.dart              # KTX ì—­ ëª©ë¡ (List<String>)
â”‚   â”‚   â”œâ”€â”€ api_config.dart            # API Base URL, íƒ€ì„ì•„ì›ƒ, í—¤ë”
â”‚   â”‚   â””â”€â”€ app_enums.dart             # MonitorStatus, SeatType ë“± enum
â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â””â”€â”€ app_theme.dart             # ì•± í…Œë§ˆ (ìƒ‰ìƒ, í°íŠ¸, ìƒíƒœë³„ ìƒ‰ìƒ)
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ logger.dart                # ì¸ë©”ëª¨ë¦¬ ë¡œê·¸ ë²„í¼ (ìµœëŒ€ 500ê±´)
â”‚
â”œâ”€â”€ data/                              # ë°ì´í„° ê³„ì¸µ
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ train.dart                 # Train ëª¨ë¸ (freezed)
â”‚   â”‚   â”œâ”€â”€ reservation.dart           # Reservation ëª¨ë¸ (freezed)
â”‚   â”‚   â”œâ”€â”€ search_condition.dart      # SearchCondition ëª¨ë¸ (freezed)
â”‚   â”‚   â””â”€â”€ log_entry.dart             # LogEntry ëª¨ë¸ (freezed)
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ train_repository.dart      # API í˜¸ì¶œ ì¶”ìƒí™”, ì—ëŸ¬ ë³€í™˜
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ api_client.dart            # dio ì¸ìŠ¤í„´ìŠ¤, ì¸í„°ì…‰í„° ì„¤ì •
â”‚
â”œâ”€â”€ presentation/                      # UI ê³„ì¸µ
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ search_screen.dart         # ê²€ìƒ‰ ì¡°ê±´ ì…ë ¥ í™”ë©´
â”‚   â”‚   â”œâ”€â”€ monitor_screen.dart        # ìë™ ì¡°íšŒ ëª¨ë‹ˆí„°ë§ í™”ë©´
â”‚   â”‚   â””â”€â”€ result_screen.dart         # ì˜ˆì•½ ê²°ê³¼ í™”ë©´
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ station_selector.dart      # ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´/ìë™ì™„ì„±
â”‚   â”‚   â”œâ”€â”€ status_badge.dart          # ìƒíƒœ í‘œì‹œ ë°°ì§€ (idle/searching/...)
â”‚   â”‚   â”œâ”€â”€ train_card.dart            # ì—´ì°¨ ì •ë³´ ì¹´ë“œ ìœ„ì ¯
â”‚   â”‚   â””â”€â”€ log_tile.dart              # ë¡œê·¸ í•­ëª© íƒ€ì¼ ìœ„ì ¯
â”‚   â””â”€â”€ providers/
â”‚       â”œâ”€â”€ search_provider.dart       # ê²€ìƒ‰ ì¡°ê±´ ë° ê²°ê³¼ ìƒíƒœ ê´€ë¦¬
â”‚       â”œâ”€â”€ monitor_provider.dart      # ìë™ ì¡°íšŒ íƒ€ì´ë¨¸, ìƒíƒœ ì „ì´ ê´€ë¦¬
â”‚       â””â”€â”€ reservation_provider.dart  # ì˜ˆì•½ ìƒíƒœ ê´€ë¦¬
â”‚
â””â”€â”€ router.dart                        # GoRouter ë¼ìš°íŠ¸ ì •ì˜
```

### 2.3 í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ìƒì„¸

#### 2.3.1 main.dart

ì•± ì§„ì…ì . Riverpodì˜ `ProviderScope`ë¡œ ì „ì²´ ìœ„ì ¯ íŠ¸ë¦¬ë¥¼ ë˜í•‘í•œë‹¤.

```dart
void main() {
  runApp(
    const ProviderScope(
      child: AutoKtxApp(),
    ),
  );
}
```

#### 2.3.2 app.dart

`MaterialApp.router`ë¥¼ ì‚¬ìš©í•˜ì—¬ GoRouter ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜ì„ êµ¬ì„±í•œë‹¤. `AppTheme`ì„ ì ìš©í•œë‹¤.

#### 2.3.3 router.dart

GoRouter ë¼ìš°íŠ¸ ì •ì˜. `StatefulShellRoute`ë¥¼ ì‚¬ìš©í•˜ì—¬ BottomNavigationBar ê¸°ë°˜ 3íƒ­ êµ¬ì¡°ë¥¼ êµ¬ì„±í•œë‹¤.

```
/ (redirect â†’ /search)
â”œâ”€â”€ /search          â†’ SearchScreen   (ê²€ìƒ‰ íƒ­)
â”œâ”€â”€ /monitor         â†’ MonitorScreen  (ëª¨ë‹ˆí„° íƒ­)
â””â”€â”€ /result          â†’ ResultScreen   (ê²°ê³¼ íƒ­)
```

#### 2.3.4 Providers (ViewModel ì—­í• )

| Provider | íƒ€ì… | ì—­í•  |
|----------|------|------|
| `searchProvider` | `StateNotifierProvider` | ê²€ìƒ‰ ì¡°ê±´ ê´€ë¦¬, ì—´ì°¨ ëª©ë¡ ì¡°íšŒ ìš”ì²­ |
| `monitorProvider` | `StateNotifierProvider` | Timer.periodic ê¸°ë°˜ ìë™ ì¡°íšŒ, ìƒíƒœ ì „ì´(idle/searching/found/reserving/success/failure) |
| `reservationProvider` | `StateNotifierProvider` | ì˜ˆì•½ ìš”ì²­ ë° ê²°ê³¼ ìƒíƒœ ê´€ë¦¬ |

#### 2.3.5 ìƒíƒœ ì „ì´ (MonitorStatus enum)

```
idle â”€â”€[ì¡°íšŒ ì‹œì‘]â”€â”€â–º searching â”€â”€[ì¢Œì„ ë°œê²¬]â”€â”€â–º found â”€â”€[ìë™ì˜ˆì•½ ON]â”€â”€â–º reserving
  â–²                      â–²                                                  â”‚
  â”‚                      â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      â”‚                                          â–¼               â–¼
  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ failure          success
  â”‚                           (ìë™ ì¬ì‹œë„ ì‹œ)                                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    (ì™„ë£Œ/ìˆ˜ë™ ì •ì§€)
```

#### 2.3.6 ApiClient (dio ì„¤ì •)

```dart
// í•µì‹¬ ì„¤ì • ê°’
BaseOptions(
  baseUrl: 'http://localhost:8000',   // ë¡œì»¬ FastAPI ì„œë²„
  connectTimeout: Duration(seconds: 10),
  receiveTimeout: Duration(seconds: 30),
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
)
```

ì¸í„°ì…‰í„° êµ¬ì„±:
- **AuthInterceptor**: ìš”ì²­ ì‹œ `session_token`ì„ `Authorization: Bearer <token>` í—¤ë”ì— ì¶”ê°€
- **LoggingInterceptor**: ìš”ì²­/ì‘ë‹µ ë¡œê·¸ë¥¼ `Logger`ì— ê¸°ë¡
- **RetryInterceptor**: 401 ì‘ë‹µ ì‹œ ìë™ ì¬ë¡œê·¸ì¸ í›„ ì›ë˜ ìš”ì²­ ì¬ì‹œë„

#### 2.3.7 TrainRepository

ApiClientë¥¼ ì‚¬ìš©í•˜ì—¬ Backend APIë¥¼ í˜¸ì¶œí•˜ê³ , HTTP ì—ëŸ¬ë¥¼ ì•± ë„ë©”ì¸ ì—ëŸ¬ë¡œ ë³€í™˜í•œë‹¤.

```
API ì‘ë‹µ ì½”ë“œ â†’ ì•± ë‚´ë¶€ ì˜ˆì™¸ ë§¤í•‘:
  200     â†’ ì •ìƒ ë°ì´í„° ë°˜í™˜
  400     â†’ InvalidParamsException
  401     â†’ SessionExpiredException
  403     â†’ AccountBlockedException
  404     â†’ NotFoundException
  409     â†’ SoldOutException
  503     â†’ KorailServerException
  ê¸°íƒ€    â†’ UnknownApiException
```

#### 2.3.8 Logger (ì¸ë©”ëª¨ë¦¬ ë¡œê·¸)

```dart
class Logger {
  static const int maxLogEntries = 500;
  final List<LogEntry> _logs = [];

  void log(String action, String result, String detail);
  List<LogEntry> get logs;   // ìµœê·¼ ìˆœ ì •ë ¬
  void clear();
}
```

### 2.4 í™”ë©´ë³„ UI êµ¬ì„±

#### SearchScreen (ê²€ìƒ‰ í™”ë©´)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         KTX ìë™ ì˜ˆì•½         â”‚  AppBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚
â”‚  ì¶œë°œì—­  [ì„œìš¸        â–¼]     â”‚  StationSelector
â”‚  ë„ì°©ì—­  [ë¶€ì‚°        â–¼]     â”‚  StationSelector
â”‚                              â”‚
â”‚  ë‚ ì§œ    [2026-02-05  ğŸ“…]    â”‚  DatePicker
â”‚  ì‹œê°„    [09:00       ğŸ•]    â”‚  TimePicker
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ìë™ ì˜ˆì•½        [ON]  â”‚  â”‚  Toggle Switch
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      ì¡°íšŒ ì‹œì‘          â”‚  â”‚  ElevatedButton
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”€â”€â”€ ì¡°íšŒ ê²°ê³¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ KTX-101  09:00â†’11:30  â”‚  â”‚  TrainCard
â”‚  â”‚ ì„œìš¸â†’ë¶€ì‚°  ì¼ë°˜ì‹¤ âœ“    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ KTX-103  10:00â†’12:30  â”‚  â”‚  TrainCard
â”‚  â”‚ ì„œìš¸â†’ë¶€ì‚°  ë§¤ì§„        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ê²€ìƒ‰]    [ëª¨ë‹ˆí„°]   [ê²°ê³¼] â”‚  BottomNavBar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MonitorScreen (ëª¨ë‹ˆí„°ë§ í™”ë©´)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ëª¨ë‹ˆí„°ë§              â”‚  AppBar + [ì¤‘ì§€] ë²„íŠ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ìƒíƒœ: [ì¡°íšŒ ì¤‘... ğŸ”µ] â”‚  â”‚  StatusBadge
â”‚  â”‚  ì¡°íšŒ íšŸìˆ˜: 42         â”‚  â”‚
â”‚  â”‚  ë§ˆì§€ë§‰ ì¡°íšŒ: 14:32:05 â”‚  â”‚
â”‚  â”‚  ë‹¤ìŒ ì¡°íšŒ: 3ì´ˆ í›„     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ê²€ìƒ‰ ì¡°ê±´              â”‚  â”‚  ì¡°ê±´ ìš”ì•½ ì¹´ë“œ
â”‚  â”‚ ì„œìš¸â†’ë¶€ì‚° 2026-02-05   â”‚  â”‚
â”‚  â”‚ 09:00~ ìë™ì˜ˆì•½: ON    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”€â”€â”€ ì‹¤ì‹œê°„ ë¡œê·¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  14:32:05 ì¡°íšŒ - ì¢Œì„ ì—†ìŒ  â”‚  LogTile
â”‚  14:32:00 ì¡°íšŒ - ì¢Œì„ ì—†ìŒ  â”‚  LogTile
â”‚  14:31:55 ì¡°íšŒ - ì¢Œì„ ì—†ìŒ  â”‚  LogTile
â”‚  14:31:50 ì¡°íšŒ ì‹œì‘         â”‚  LogTile
â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ê²€ìƒ‰]    [ëª¨ë‹ˆí„°]   [ê²°ê³¼] â”‚  BottomNavBar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ResultScreen (ê²°ê³¼ í™”ë©´)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ì˜ˆì•½ ê²°ê³¼             â”‚  AppBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      âœ“ ì˜ˆì•½ ì„±ê³µ       â”‚  â”‚  ì„±ê³µ ì¹´ë“œ (ì´ˆë¡)
â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚  ì˜ˆì•½ë²ˆí˜¸: R2026020201 â”‚  â”‚
â”‚  â”‚  KTX-101               â”‚  â”‚
â”‚  â”‚  ì„œìš¸â†’ë¶€ì‚°              â”‚  â”‚
â”‚  â”‚  09:00 â†’ 11:30         â”‚  â”‚
â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚  âš  10ë¶„ ë‚´ ê²°ì œ í•„ìš”    â”‚  â”‚
â”‚  â”‚  ê²°ì œ ê¸°í•œ: 14:42:05   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      ìƒˆë¡œ ê²€ìƒ‰          â”‚  â”‚  ë²„íŠ¼
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”€â”€â”€ ì „ì²´ ë¡œê·¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  14:32:05 ì˜ˆì•½ - ì„±ê³µ       â”‚  LogTile
â”‚  14:32:04 ì˜ˆì•½ ì‹œë„ ì¤‘      â”‚  LogTile
â”‚  14:32:03 ì¢Œì„ ë°œê²¬         â”‚  LogTile
â”‚  ...                        â”‚
â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ê²€ìƒ‰]    [ëª¨ë‹ˆí„°]   [ê²°ê³¼] â”‚  BottomNavBar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Python ë°±ì—”ë“œ ì•„í‚¤í…ì²˜

### 3.1 ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ auth.py   â”‚ â”‚ trains.py â”‚ â”‚reservation.py â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚             â”‚              â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚      Service Layer         â”‚            â”‚
â”‚        â”‚             â”‚              â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            KorailService                   â”‚  â”‚
â”‚  â”‚  (korail2 ë˜í•‘, ì„¸ì…˜ ê´€ë¦¬, ì—ëŸ¬ ë³€í™˜)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            RetryService                    â”‚  â”‚
â”‚  â”‚  (exponential backoff, ì¬ì‹œë„ ë°ì½”ë ˆì´í„°)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Model Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            schemas.py (Pydantic)           â”‚  â”‚
â”‚  â”‚  (Request/Response ëª¨ë¸ ì •ì˜)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 í´ë” êµ¬ì¡°

```
backend/
â”œâ”€â”€ main.py                    # FastAPI ì•± ìƒì„±, CORS ì„¤ì •, ë¼ìš°í„° ë“±ë¡
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ deps.py                # ì˜ì¡´ì„± ì£¼ì… (get_korail_service ë“±)
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ auth.py            # POST /api/auth/login
â”‚       â”œâ”€â”€ trains.py          # GET /api/trains/search
â”‚       â””â”€â”€ reservation.py     # POST /api/reservation, GET /api/reservation/{id}
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ korail_service.py      # korail2 ë˜í•‘ ì„œë¹„ìŠ¤ (ë¡œê·¸ì¸, ì¡°íšŒ, ì˜ˆì•½)
â”‚   â””â”€â”€ retry_service.py       # exponential backoff ì¬ì‹œë„ ìœ í‹¸ë¦¬í‹°
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ schemas.py             # Pydantic ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
â”‚
â”œâ”€â”€ .env                       # í™˜ê²½ ë³€ìˆ˜ (KORAIL_ID, KORAIL_PW ë“±) - gitignore ëŒ€ìƒ
â”œâ”€â”€ .env.example               # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
â”œâ”€â”€ requirements.txt           # Python ì˜ì¡´ì„± ëª©ë¡
â””â”€â”€ README.md                  # Backend ì‹¤í–‰ ê°€ì´ë“œ
```

### 3.3 í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ìƒì„¸

#### 3.3.1 main.py

```python
# FastAPI ì•± ìƒì„±
app = FastAPI(title="KTX Auto Reservation API", version="1.0.0")

# CORS ì„¤ì • (Flutter ì•±ì—ì„œì˜ ìš”ì²­ í—ˆìš©)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],       # ê°œë°œ í™˜ê²½: ì „ì²´ í—ˆìš©
    allow_methods=["*"],
    allow_headers=["*"],
)

# ë¼ìš°í„° ë“±ë¡
app.include_router(auth_router, prefix="/api/auth", tags=["auth"])
app.include_router(trains_router, prefix="/api/trains", tags=["trains"])
app.include_router(reservation_router, prefix="/api", tags=["reservation"])

# ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬
@app.exception_handler(KorailException)
async def korail_exception_handler(request, exc):
    ...
```

#### 3.3.2 KorailService

korail2 ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë˜í•‘í•˜ì—¬ ì„¸ì…˜ ê´€ë¦¬ì™€ ì—ëŸ¬ ë³€í™˜ì„ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ì„œë¹„ìŠ¤.

```python
class KorailService:
    def __init__(self):
        self._korail = None           # korail2.Korail ì¸ìŠ¤í„´ìŠ¤
        self._session_token = None    # í˜„ì¬ ì„¸ì…˜ í† í°
        self._expires_at = None       # ì„¸ì…˜ ë§Œë£Œ ì‹œê°

    async def login(self, korail_id: str, korail_pw: str) -> dict
    async def search_trains(self, dep: str, arr: str, date: str, time: str) -> list
    async def reserve(self, train_no: str, seat_type: str) -> dict
    async def get_reservation(self, reservation_id: str) -> dict

    def is_session_valid(self) -> bool
    async def _ensure_session(self) -> None    # ì„¸ì…˜ ë§Œë£Œ ì‹œ ìë™ ì¬ë¡œê·¸ì¸
```

ì„¸ì…˜ ê´€ë¦¬ ì „ëµ:
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„¸ì…˜ í† í°ê³¼ ë§Œë£Œ ì‹œê°ì„ ë©”ëª¨ë¦¬ì— ìºì‹±
- ë§¤ API í˜¸ì¶œ ì „ `_ensure_session()`ìœ¼ë¡œ ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬
- ì„¸ì…˜ ë§Œë£Œ ì‹œ ì €ì¥ëœ credentialsë¡œ ìë™ ì¬ë¡œê·¸ì¸ ì‹œë„
- ì¬ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ `SESSION_EXPIRED` ì—ëŸ¬ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜

#### 3.3.3 RetryService

```python
class RetryService:
    """Exponential backoff ì¬ì‹œë„ ìœ í‹¸ë¦¬í‹°"""

    BACKOFF_SCHEDULE = [5, 10, 20, 60]  # ì´ˆ ë‹¨ìœ„ (ìµœëŒ€ 60ì´ˆ)

    @staticmethod
    async def with_retry(func, max_retries=4):
        """
        ì‹¤íŒ¨ ì‹œ backoff ìŠ¤ì¼€ì¤„ì— ë”°ë¼ ì¬ì‹œë„.
        5s â†’ 10s â†’ 20s â†’ 60s
        """
        ...
```

#### 3.3.4 deps.py (ì˜ì¡´ì„± ì£¼ì…)

```python
# ì‹±ê¸€í†¤ KorailService ì¸ìŠ¤í„´ìŠ¤
_korail_service = KorailService()

async def get_korail_service() -> KorailService:
    return _korail_service

async def verify_session(
    authorization: str = Header(None),
    service: KorailService = Depends(get_korail_service),
) -> KorailService:
    """ì„¸ì…˜ í† í° ê²€ì¦ ì˜ì¡´ì„±"""
    if not service.is_session_valid():
        raise HTTPException(status_code=401, detail="ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤")
    return service
```

#### 3.3.5 schemas.py (Pydantic ëª¨ë¸)

```python
# ìš”ì²­ ëª¨ë¸
class LoginRequest(BaseModel):
    korail_id: str
    korail_pw: str

# ì‘ë‹µ ëª¨ë¸
class TrainInfo(BaseModel):
    train_no: str
    train_type: str
    dep_station: str
    arr_station: str
    dep_time: str
    arr_time: str
    general_seats: bool
    special_seats: bool

class LoginResponse(BaseModel):
    session_token: str
    expires_at: str
    message: str

class TrainSearchResponse(BaseModel):
    trains: list[TrainInfo]
    searched_at: str

class ReservationResponse(BaseModel):
    reservation_id: str
    status: str
    train: TrainInfo
    message: str
    reserved_at: str

class ErrorResponse(BaseModel):
    error: str
    code: str
    detail: str
```

---

## 4. ë°ì´í„° ëª¨ë¸ ì„¤ê³„

### 4.1 Flutter ëª¨ë¸ (freezed ê¸°ë°˜)

#### Train

```dart
@freezed
class Train with _$Train {
  const factory Train({
    required String trainNo,       // "KTX-101"
    required String trainType,     // "KTX"
    required String depStation,    // "ì„œìš¸"
    required String arrStation,    // "ë¶€ì‚°"
    required String depTime,       // "09:00"
    required String arrTime,       // "11:30"
    required bool generalSeats,    // ì¼ë°˜ì‹¤ ì¢Œì„ ì—¬ë¶€
    required bool specialSeats,    // íŠ¹ì‹¤ ì¢Œì„ ì—¬ë¶€
  }) = _Train;

  factory Train.fromJson(Map<String, dynamic> json) => _$TrainFromJson(json);
}
```

#### SearchCondition

```dart
@freezed
class SearchCondition with _$SearchCondition {
  const factory SearchCondition({
    required String depStation,        // ì¶œë°œì—­
    required String arrStation,        // ë„ì°©ì—­
    required String date,              // "YYYYMMDD"
    required String time,              // "HHmmss"
    @Default("KTX") String trainType,
    @Default(false) bool autoReserve,
    @Default(10) int refreshInterval,  // ì¡°íšŒ ì£¼ê¸° (ì´ˆ)
  }) = _SearchCondition;

  factory SearchCondition.fromJson(Map<String, dynamic> json) =>
      _$SearchConditionFromJson(json);
}
```

#### Reservation

```dart
@freezed
class Reservation with _$Reservation {
  const factory Reservation({
    required String reservationId,    // "R20260202001"
    required String status,           // "success" | "failure"
    required Train train,
    required String message,
    required DateTime reservedAt,
    DateTime? paymentDeadline,
  }) = _Reservation;

  factory Reservation.fromJson(Map<String, dynamic> json) =>
      _$ReservationFromJson(json);
}
```

#### LogEntry

```dart
@freezed
class LogEntry with _$LogEntry {
  const factory LogEntry({
    required DateTime timestamp,
    required String action,   // "search" | "reserve" | "login" | "error"
    required String result,   // "success" | "failure" | "no_seats"
    required String detail,
  }) = _LogEntry;

  factory LogEntry.fromJson(Map<String, dynamic> json) =>
      _$LogEntryFromJson(json);
}
```

### 4.2 ìƒíƒœ Enum

```dart
enum MonitorStatus {
  idle,        // ëŒ€ê¸° - íšŒìƒ‰
  searching,   // ì¡°íšŒ ì¤‘ - íŒŒë‘
  found,       // ì¢Œì„ ë°œê²¬ - ì´ˆë¡
  reserving,   // ì˜ˆì•½ ì¤‘ - ì£¼í™©
  success,     // ì˜ˆì•½ ì„±ê³µ - ì´ˆë¡
  failure,     // ì˜ˆì•½ ì‹¤íŒ¨ - ë¹¨ê°•
}

enum SeatType {
  general,     // ì¼ë°˜ì‹¤
  special,     // íŠ¹ì‹¤
}
```

---

## 5. ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### 5.1 ì—ëŸ¬ ì½”ë“œ ì²´ê³„

| ë²”ì£¼ | ì½”ë“œ ë²”ìœ„ | ì„¤ëª… |
|------|-----------|------|
| AUTH_0XX | ì¸ì¦ | ë¡œê·¸ì¸ ì‹¤íŒ¨, ê³„ì • ì°¨ë‹¨ |
| SEARCH_0XX | ê²€ìƒ‰ | ì˜ëª»ëœ íŒŒë¼ë¯¸í„°, ì—´ì°¨ ì—†ìŒ, ì„œë²„ ì˜¤ë¥˜ |
| RESERVE_0XX | ì˜ˆì•½ | ë§¤ì§„, ì„¸ì…˜ ë§Œë£Œ, ì˜ˆì•½ ì—†ìŒ |
| SYSTEM_0XX | ì‹œìŠ¤í…œ | ë‚´ë¶€ ì˜¤ë¥˜, íƒ€ì„ì•„ì›ƒ |

### 5.2 ì—ëŸ¬ íë¦„

```
ì½”ë ˆì¼ ì„œë²„ ì—ëŸ¬
       â”‚
       â–¼
KorailService (ì—ëŸ¬ ê°ì§€ ë° ë¶„ë¥˜)
       â”‚
       â–¼
FastAPI Route (ì—ëŸ¬ ì½”ë“œ + HTTP ìƒíƒœì½”ë“œ ë§¤í•‘)
       â”‚
       â–¼
JSON ì—ëŸ¬ ì‘ë‹µ {"error": "...", "code": "...", "detail": "..."}
       â”‚
       â–¼
ApiClient (dio) - HTTP ìƒíƒœì½”ë“œë¡œ ì—ëŸ¬ ê°ì§€
       â”‚
       â–¼
TrainRepository (JSON íŒŒì‹±, ì•± ì˜ˆì™¸ë¡œ ë³€í™˜)
       â”‚
       â–¼
Provider (ìƒíƒœ ì—…ë°ì´íŠ¸, UI ì—ëŸ¬ ë©”ì‹œì§€ ìƒì„±)
       â”‚
       â–¼
Screen (SnackBar, ë‹¤ì´ì–¼ë¡œê·¸ ë“±ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ)
```

### 5.3 Exponential Backoff ì „ëµ

```
ì‹œë„ 1: ì¦‰ì‹œ ì‹¤í–‰
ì‹œë„ 2: 5ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
ì‹œë„ 3: 10ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
ì‹œë„ 4: 20ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
ì‹œë„ 5: 60ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„ (ìµœëŒ€)
ì´í›„:  60ì´ˆ ê°„ê²© ìœ ì§€ ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì‹¤íŒ¨ ì•Œë¦¼
```

ì ìš© ëŒ€ìƒ:
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ (ì—°ê²° ì‹¤íŒ¨, íƒ€ì„ì•„ì›ƒ)
- ì½”ë ˆì¼ ì„œë²„ ì¥ì•  (503)
- ì¼ì‹œì  ì˜¤ë¥˜ (500)

ì¦‰ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬ (ì¬ì‹œë„ ì•ˆ í•¨):
- ì¸ì¦ ì‹¤íŒ¨ (401, 403)
- ì˜ëª»ëœ ìš”ì²­ (400)
- ë§¤ì§„ (409) -- ë‹¨, ìë™ ì¡°íšŒ ëª¨ë“œì—ì„œëŠ” ì¡°íšŒ ìì²´ë¥¼ ë°˜ë³µ

### 5.4 ì•± Lifecycle ê´€ë¦¬

```dart
class MonitorProvider extends StateNotifier<MonitorState>
    with WidgetsBindingObserver {

  @override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    switch (state) {
      case AppLifecycleState.paused:
        _pauseTimer();      // ë°±ê·¸ë¼ìš´ë“œ ì§„ì… ì‹œ íƒ€ì´ë¨¸ ì¼ì‹œ ì •ì§€
        break;
      case AppLifecycleState.resumed:
        _resumeTimer();     // í¬ê·¸ë¼ìš´ë“œ ë³µê·€ ì‹œ íƒ€ì´ë¨¸ ì¬ê°œ
        break;
      default:
        break;
    }
  }
}
```

---

## 6. ì˜ì¡´ì„± ëª©ë¡

### 6.1 Flutter (pubspec.yaml)

```yaml
dependencies:
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.8
  dio: ^5.4.0                    # HTTP í´ë¼ì´ì–¸íŠ¸
  flutter_riverpod: ^2.4.0       # ìƒíƒœ ê´€ë¦¬
  go_router: ^14.0.0             # ì„ ì–¸ì  ë¼ìš°íŒ…
  intl: ^0.19.0                  # ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ…
  freezed_annotation: ^2.4.0     # ë¶ˆë³€ ëª¨ë¸ ì–´ë…¸í…Œì´ì…˜

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^5.0.0
  freezed: ^2.4.0                # ì½”ë“œ ìƒì„±ê¸°
  build_runner: ^2.4.0           # ë¹Œë“œ ëŸ¬ë„ˆ
  json_serializable: ^6.7.0      # JSON ì§ë ¬í™” ì½”ë“œ ìƒì„±
```

### 6.2 Python Backend (requirements.txt)

```
fastapi>=0.109.0
uvicorn>=0.27.0
korail2>=0.1.0
python-dotenv>=1.0.0
pydantic>=2.5.0
```

### 6.3 í™˜ê²½ ë³€ìˆ˜ (.env.example)

```env
# ì½”ë ˆì¼ ê³„ì • (í•˜ë“œì½”ë”© ê¸ˆì§€)
KORAIL_ID=your_korail_id
KORAIL_PW=your_korail_pw

# ì„œë²„ ì„¤ì •
HOST=0.0.0.0
PORT=8000
DEBUG=true
```

---

## 7. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ëŒ€ì±… |
|------|------|
| ì½”ë ˆì¼ ê³„ì • ì •ë³´ | Backend `.env` íŒŒì¼ì—ì„œë§Œ ê´€ë¦¬, `.gitignore`ì— `.env` ì¶”ê°€ |
| ì„¸ì…˜ í† í° | Backend ë©”ëª¨ë¦¬ì—ì„œë§Œ ê´€ë¦¬, í´ë¼ì´ì–¸íŠ¸ì— ì§ì ‘ ì½”ë ˆì¼ ì„¸ì…˜ ë…¸ì¶œ ì•ˆ í•¨ |
| API í†µì‹  | ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì „ìš© (localhost), ê°œë°œ í™˜ê²½ í•œì • |
| ìš”ì²­ ë¹ˆë„ | ìµœì†Œ 5ì´ˆ ê°„ê²© ì œí•œ, ì¼ì¼ ìš”ì²­ í•œë„ ì„¤ì •ìœ¼ë¡œ ì°¨ë‹¨ ë°©ì§€ |
| í•˜ë“œì½”ë”© ê¸ˆì§€ | ëª¨ë“  ë¯¼ê° ì •ë³´ëŠ” í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ì„¤ì • íŒŒì¼ë¡œ ë¶„ë¦¬ |

---

## 8. WBS ë§¤í•‘

| Phase | ì•„í‚¤í…ì²˜ ì»´í¬ë„ŒíŠ¸ | ê´€ë ¨ Task ID |
|-------|------------------|-------------|
| Phase 1 | FastAPI ì´ˆê¸° ì„¤ì •, main.py, CORS | P1-BE-001 |
| Phase 1 | auth.py, KorailService.login() | P1-BE-002 |
| Phase 1 | trains.py, KorailService.search_trains() | P1-BE-003 |
| Phase 1 | Flutter í”„ë¡œì íŠ¸ êµ¬ì¡° (core/data/presentation) | P1-FE-001 |
| Phase 1 | Train, SearchCondition, Reservation, LogEntry ëª¨ë¸ | P1-FE-002 |
| Phase 1 | ApiClient (dio), ì¸í„°ì…‰í„° | P1-FE-003 |
| Phase 1 | SearchScreen, StationSelector | P1-FE-004 |
| Phase 1 | TrainCard, ì—´ì°¨ ëª©ë¡ ListView | P1-FE-005 |
| Phase 2 | search/monitor/reservationProvider | P2-FE-001 |
| Phase 2 | MonitorScreen, StatusBadge, LogTile | P2-FE-002 |
| Phase 2 | Timer.periodic, WidgetsBindingObserver | P2-FE-003 |
| Phase 2 | MonitorStatus enum, ìƒíƒœ ì „ì´ ë¡œì§ | P2-FE-004 |
| Phase 2 | GoRouter, BottomNavigationBar | P2-FE-005 |
| Phase 3 | reservation.py, KorailService.reserve() | P3-BE-001 |
| Phase 3 | KorailService ì„¸ì…˜ ìºì‹±, ìë™ ì¬ë¡œê·¸ì¸ | P3-BE-002 |
| Phase 3 | RetryService, backoff ë°ì½”ë ˆì´í„° | P3-BE-003 |
| Phase 3 | ResultScreen | P3-FE-001 |
| Phase 3 | Mock ì œê±°, ì‹¤ API ì—°ë™, ì—ëŸ¬ í•¸ë“¤ë§ | P3-FE-002 |
| Phase 4 | Backend ë¡œê¹… ê°•í™” | P4-BE-001 |
| Phase 4 | ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬, ì—ëŸ¬ ì½”ë“œ ì²´ê³„ | P4-BE-002 |
| Phase 4 | Frontend ì—ëŸ¬ í•¸ë“¤ë§ í†µí•© | P4-FE-001 |
| Phase 4 | ë¡œê·¸ ë·°ì–´ (Logger, LogTile) | P4-FE-002 |
